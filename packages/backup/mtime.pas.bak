(*
 Copyright Â© by Patryk Wychowaniec, 2013
 All rights reserved.
*)
{$H+}
Unit mTime;

 Interface

 Implementation
Uses Machine, os_functions;

{ time.get_tick_count }
Procedure _get_tick_count(M: TMachine);
{$IFDEF LINUX}
 Type ptimespec = ^timespec;
      timespec = Packed record
                  tv_sec, tv_nsec: {$IFDEF cpu64}int64{$ELSE}longint{$ENDIF};
                 End;
 Var T: timespec;
{$ENDIF}
Begin
 {$IFDEF WINDOWS}
  M.StackPush(GetTickCount);
 {$ELSE LINUX}
  clock_gettime(CLOCK_MONOTONIC, @T);
  M.StackPush(T.tv_nsec);
 {$ENDIF}
End;

initialization
 NewFunction('time', 'get_tick_count', @_get_tick_count);
End.